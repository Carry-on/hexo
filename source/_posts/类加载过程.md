---
title: 类加载过程
date: 2020-05-21 20:55:22
tags: jvm
---

# 类加载过程

加载 --> （验证 --> 准备 --> 解析） --> 初始化 --> 使用 --> 卸载

## 加载
1.通过一个类的全路径名来获取定义此类的二进制流。
2.将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。
3.在内存中生成一个代表这个类的java.long.Class对象，作为方法区这个类的各种数据的访问入口。

## 验证
确保Class文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害到虚拟机自身安全。

#### 1.文件格式验证
第一阶段验证字节流是否符合Class文件格式规范，并且能被当前虚拟机处理

a）是否以魔数0xCAFEBABY开头。
b）主，次版本号是否在当前虚拟机处理范围
c）常量池的常量是否有不支持的常量类型（检查常量tag标志）
d）指向常量的各种索引值中是否有指向不存在的常量或不符合类型的常量。
e）CONSTANT_Utf8_info型的常量中是否有不符合UTF8编码的数据
f）Class文件中各个部分及文件本身是否被删除或附加其他信息。

#### 2.元数据验证
对字节码描述的信息进行语义分析，以保证其描述的信息符合Java语言规范

a）这个类是否有父类
b）这个类的父类是否继承了不允许被继承的类
c）如果这个类不是抽象类，是否实现了其父类或接口中所要求实现的所有方法。
e）类中的字段，方法是否于父类产生矛盾。

#### 3.字节码验证
整个验证过程中最复杂的阶段，主要目的是通过数据流和控制流分析，确定程序语义是合法的、符合逻辑的

#### 4.符号引用验证
这一步发生在虚拟机将符号引用转化为直接引用的时候，这个转化动作将在解析阶段中发生

a）符号引用中通过字符串描述的全限定名是否找到对应的类
b）在指定类中是否存在符合方法的字段描述副以及简单名称描述的方法和字段。
c）符号引用中的类，字段，方法的访问性是否可以被当前类访问。

## 准备
为类变量分配内存并甚至初始值。

## 解析
将常量池中的符号引用替换成直接引用的过程。

#### 1.类或接口解析

#### 2.字段解析

#### 3.类方法解析

#### 4.接口方法解析

## 初始化
真正执行类中定义的Java程序代码


